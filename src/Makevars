PKG_CPPFLAGS = -I.
PKG_LIBS = -lprofiler main.a

#GO = /usr/lib/go-1.9/bin/go
GO = go
CGO_CPPFLAGS = "$(ALL_CPPFLAGS)"
CGO_CFLAGS = "$(ALL_CFLAGS)"
GOPATH = $(CURDIR)/go

-include Makevars.local

all: $(SHLIB)

$(SHLIB): main.a

main.a go.cpp: $(GO_SRC)
	echo $(GO_SRC)
	CGO_CFLAGS=$(CGO_CFLAGS) GOPATH=$(GOPATH) $(GO) build -buildmode=c-archive -gcflags=-shared -asmflags=-shared -installsuffix=_shared -x R/main
	GOPATH=$(GOPATH) $(GO) build github.com/google/pprof && cp pprof ../inst/bin/
