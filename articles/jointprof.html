<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to joint profiling of native and R code • jointprof</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to joint profiling of native and R code">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jointprof</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jointprof.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/internals.html">Collecting and merging dual call stacks</a>
    </li>
    <li>
      <a href="../articles/proposal.html">Proposal: Joint profiling of native and R code</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-prof/gprofiler">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to joint profiling of native and R code</h1>
                        <h4 class="author">Kirill Müller</h4>
            
            <h4 class="date">2019-04-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-prof/gprofiler/blob/master/vignettes/jointprof.Rmd"><code>vignettes/jointprof.Rmd</code></a></small>
      <div class="hidden name"><code>jointprof.Rmd</code></div>

    </div>

    
    
<p>The three rules of software optimization are:</p>
<ol style="list-style-type: decimal">
<li>Don’t.</li>
<li>Don’t do it yet.</li>
<li>Profile before optimizing.</li>
</ol>
<p>A profiler is a tool that identifies which parts of your code take the most time. One way to do this is to run the code and halt execution every so often (by default 50 times per second), and record the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/sys.parent">call stack</a> on each occurrence. The combined samples will likely show in which part of your code the most time is spent.</p>
<p>In R, a sampling profiler is available via <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/Rprof"><code><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof()</a></code></a>, but it provides detailed measurements only for R code. This vignette shows how to include detailed information on native code run times in the profile.</p>
<div id="prerequisite-code-to-profile" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisite-code-to-profile" class="anchor"></a>Prerequisite: Code to profile</h2>
<p>For this vignette, we’ll be profiling R and C++ implementations of functions that computes the Fibonacci sequence using <a href="https://en.wikipedia.org/wiki/Dynamic_programming#In_computer_programming">dynamic programming</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">fib_r &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="cf">if</span> (x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, x))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  fib &lt;-<span class="st"> </span><span class="kw">fib_r</span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(fib, fib[x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>fib[x <span class="op">-</span><span class="st"> </span><span class="dv">2</span>])</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">}</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">// [[Rcpp::export]]</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">Rcpp::NumericVector fib_cpp(<span class="dt">int</span> x) {</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="cf">if</span> (x &lt;= <span class="dv">1</span>) <span class="cf">return</span> Rcpp::NumericVector::create(<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="cf">if</span> (x &lt;= <span class="dv">2</span>) <span class="cf">return</span> Rcpp::NumericVector::create(<span class="dv">1</span>, <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  Rcpp::NumericVector fib = fib_cpp(x - <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="co">// Zero-based indexing!</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  fib.push_back(fib[x - <span class="dv">1</span> - <span class="dv">1</span>] + fib[x - <span class="dv">2</span> - <span class="dv">1</span>]);</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="cf">return</span> fib;</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">}</a></code></pre></div>
<p>(A few tweaks are necessary to allow profiling the <em>Rcpp</em>-compiled function when run from the vignette. See the source for details.)</p>
<p>The implementations are supposed to behave identically.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">fib_r</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;  [1]  1  1  2  3  5  8 13 21 34 55</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">fib_cpp</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  [1]  1  1  2  3  5  8 13 21 34 55</span></a></code></pre></div>
<p>Our test function <code>test()</code> calls both functions and compares their output in a loop:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">test &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(i)) {</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stopifnot">stopifnot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(<span class="kw">fib_r</span>(i), <span class="kw">fib_cpp</span>(i)))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">}</a></code></pre></div>
</div>
<div id="a-minimal-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-minimal-example" class="anchor"></a>A minimal example</h2>
<p><code><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof()</a></code> creates a text file that contains the stack trace for each interruption. The <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/summaryRprof"><code><a href="https://www.rdocumentation.org/packages/utils/topics/summaryRprof">summaryRprof()</a></code></a> function converts this to a data frame with one row per function and the corresponding run time estimates (self: code in that function only, total: including all descendant functions):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">out_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="st">"jointprof"</span>, <span class="dt">fileext =</span> <span class="st">".out"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof</a></span>(out_file, <span class="dt">gc.profiling =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">test</span>(<span class="dv">800</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof</a></span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">summary &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/summaryRprof">summaryRprof</a></span>(out_file)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">summary<span class="op">$</span>by.self</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;               self.time self.pct total.time total.pct</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; "fib_r"            5.06    36.35       9.86     70.83</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; "c"                3.30    23.71       4.08     29.31</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; ".Call"            2.96    21.26       3.72     26.72</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; "&lt;GC&gt;"             1.66    11.93       1.66     11.93</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; "-"                0.50     3.59       0.52      3.74</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; "identical"        0.08     0.57      13.66     98.13</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; "&lt;="               0.08     0.57       0.08      0.57</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; "sys.parent"       0.08     0.57       0.08      0.57</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; "stopifnot"        0.04     0.29      13.92    100.00</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; "...elt"           0.04     0.29      13.70     98.42</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; "+"                0.04     0.29       0.04      0.29</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; "doTryCatch"       0.02     0.14      13.92    100.00</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; "tryCatchOne"      0.02     0.14      13.92    100.00</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; "sys.call"         0.02     0.14       0.04      0.29</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; "all"              0.02     0.14       0.02      0.14</span></a></code></pre></div>
<p>This is a nice overview, but for <code>fun_cpp()</code> the run time is hidden in the entry for <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/CallExternal"><code><a href="https://www.rdocumentation.org/packages/base/topics/CallExternal">.Call()</a></code></a>: calls into native code are opaque and cannot be resolved further. Enter joint profiling:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(jointprof)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">out_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="st">"jointprof"</span>, <span class="dt">fileext =</span> <span class="st">".out"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="../reference/start_profiler.html">start_profiler</a></span>(out_file)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; Temporary files: /tmp/RtmpIW8ynj/jointprof51e759bebb70.prof, /tmp/RtmpIW8ynj/jointprof51e73ecba0c.out</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">test</span>(<span class="dv">700</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw"><a href="../reference/start_profiler.html">stop_profiler</a></span>()</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">summary &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/summaryRprof">summaryRprof</a></span>(out_file)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">summary<span class="op">$</span>by.self</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;                                                      self.time self.pct total.time total.pct</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; "fib_r"                                                   3.84    36.29       7.80     73.72</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; "c"                                                       2.80    26.47       3.30     31.19</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; "&lt;GC&gt;"                                                    1.34    12.67       1.34     12.67</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; "RealAnswer"                                              0.32     3.02       0.46      4.35</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; "Rf_eval"                                                 0.26     2.46       0.34      3.21</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; "&lt;?&gt;"                                                     0.26     2.46       0.30      2.84</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt; "-"                                                       0.26     2.46       0.28      2.65</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; "R_gc_internal"                                           0.20     1.89       0.42      3.97</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; "_ZN4Rcpp8internal13r_init_vectorILi14EEEvP7SEXPREC"      0.18     1.70       0.20      1.89</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; "_Z7fib_cppi"                                             0.10     0.95       0.64      6.05</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt; "CONS_NR"                                                 0.08     0.76       0.20      1.89</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt; "identical"                                               0.06     0.57      10.32     97.54</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; "Rf_allocVector3"                                         0.06     0.57       0.56      5.29</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="co">#&gt; "Rf_evalList"                                             0.06     0.57       0.24      2.27</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#&gt; "match.call"                                              0.06     0.57       0.12      1.13</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt; "+"                                                       0.06     0.57       0.06      0.57</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co">#&gt; "&lt;="                                                      0.06     0.57       0.06      0.57</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="co">#&gt; "stopifnot"                                               0.04     0.38      10.58    100.00</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co">#&gt; "tryCatch"                                                0.04     0.38      10.58    100.00</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="co">#&gt; "withCallingHandlers"                                     0.04     0.38      10.58    100.00</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt; "do_subset_dflt"                                          0.04     0.38       0.08      0.76</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="co">#&gt; "Rf_defineVar"                                            0.04     0.38       0.04      0.38</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt; "sys.parent"                                              0.04     0.38       0.04      0.38</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="co">#&gt; "do_c"                                                    0.02     0.19       0.70      6.62</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="co">#&gt; "do_c_dflt"                                               0.02     0.19       0.64      6.05</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co">#&gt; "do_subset"                                               0.02     0.19       0.14      1.32</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="co">#&gt; "Rf_applyClosure"                                         0.02     0.19       0.08      0.76</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">#&gt; "Rf_matchArgs"                                            0.02     0.19       0.04      0.38</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">#&gt; "Rf_promiseArgs"                                          0.02     0.19       0.04      0.38</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">#&gt; "do_matchcall"                                            0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="co">#&gt; "length"                                                  0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42"><span class="co">#&gt; "memset"                                                  0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-43" data-line-number="43"><span class="co">#&gt; "neWithNaN"                                               0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-44" data-line-number="44"><span class="co">#&gt; "parent.frame"                                            0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45"><span class="co">#&gt; "Rf_begincontext"                                         0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-46" data-line-number="46"><span class="co">#&gt; "Rf_checkArityCall"                                       0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47"><span class="co">#&gt; "Rf_findFun3"                                             0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-48" data-line-number="48"><span class="co">#&gt; "Rf_mkPROMISE"                                            0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-49" data-line-number="49"><span class="co">#&gt; "Rf_NewEnvironment"                                       0.02     0.19       0.02      0.19</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50"><span class="co">#&gt; "vmaxset"                                                 0.02     0.19       0.02      0.19</span></a></code></pre></div>
<p>The summary now also contains a breakdown for native functions below the R code that calls them.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div id="ubuntu" class="section level3">
<h3 class="hasAnchor">
<a href="#ubuntu" class="anchor"></a>Ubuntu</h3>
<p>Other Linux distributions may work if you install the right system dependencies (<a href="https://github.com/r-prof/jointprof/issues">let me know</a> which!).</p>
<ol style="list-style-type: decimal">
<li>
<p>Install system dependencies:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="fu">sudo</span> apt install \</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  libgoogle-perftools-dev \</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  libprotoc-dev libprotobuf-dev protobuf-compiler \</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  golang-go \</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  graphviz</a></code></pre></div>
</li>
<li>
<p>Install <code>pprof</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ex">go</span> get github.com/google/pprof</a></code></pre></div>
</li>
<li>
<p>Install the package:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># install.packages("remotes")</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"r-prof/jointprof"</span>)</a></code></pre></div>
</li>
</ol>
</div>
<div id="os-x" class="section level3">
<h3 class="hasAnchor">
<a href="#os-x" class="anchor"></a>OS X</h3>
<ol style="list-style-type: decimal">
<li>
<p>Install system dependencies:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="ex">brew</span> install graphviz</a></code></pre></div>
</li>
<li>
<p>Install <code>gperftools</code> (currently from a branch, <a href="https://github.com/gperftools/gperftools/pull/1004">pull request</a> pending):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="fu">git</span> clone https://github.com/krlmlr/gperftools.git -b f-export-stack</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="bu">cd</span> gperftools</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="ex">./autogen.sh</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="ex">./configure</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="fu">make</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="fu">sudo</span> make install</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="bu">cd</span> ..</a></code></pre></div>
</li>
<li>
<p>Install <code>pprof</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="ex">go</span> get github.com/google/pprof</a></code></pre></div>
</li>
<li>
<p>Install the package:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># install.packages("remotes")</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"r-prof/jointprof"</span>)</a></code></pre></div>
</li>
</ol>
</div>
<div id="other-os" class="section level3">
<h3 class="hasAnchor">
<a href="#other-os" class="anchor"></a>Other OS</h3>
<p>Windows and Solaris are not supported.</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The <a href="https://r-prof.github.io/jointprof/reference/start_profiler.html"><code><a href="../reference/start_profiler.html">start_profiler()</a></code> and <code><a href="../reference/start_profiler.html">stop_profiler()</a></code></a> functions are replacements for <code><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof()</a></code> and <code><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof(NULL)</a></code>, respectively. The generated output file is compatible with that generated by <code><a href="https://www.rdocumentation.org/packages/utils/topics/Rprof">Rprof()</a></code>. This enables a variety of ways to analyze the results, see also the subsequent section.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">out_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="st">"jointprof"</span>, <span class="dt">fileext =</span> <span class="st">".out"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="../reference/start_profiler.html">start_profiler</a></span>(out_file)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt; Temporary files: /tmp/RtmpIW8ynj/jointprof51e716d65aa3.prof, /tmp/RtmpIW8ynj/jointprof51e74e34ff27.out</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">test</span>(<span class="dv">700</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="kw"><a href="../reference/start_profiler.html">stop_profiler</a></span>()</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strtrim">strtrim</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(out_file, <span class="dt">n =</span> <span class="dv">12</span>), <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;  [1] "line profiling: sample.interval=20000"                                                     </span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt;  [2] "#File 1: &lt;text&gt;"                                                                           </span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt;  [3] "#File 2: /home/travis/build/jimhester/r-source/src/main/memory.c"                          </span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt;  [4] "#File 3: /home/travis/build/jimhester/r-source/src/main/bind.c"                            </span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt;  [5] "#File 4: /home/travis/build/jimhester/r-source/src/main/eval.c"                            </span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt;  [6] "#File 5: /home/travis/build/jimhester/r-source/src/main/subset.c"                          </span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt;  [7] "#File 6: /home/travis/build/jimhester/r-source/src/main/attrib.c"                          </span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt;  [8] "#File 7: /tmp/RtmpIW8ynj/sourceCpp-x86_64-pc-linux-gnu-1.0.1/sourcecpp_51e751875966/file51"</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt;  [9] "#File 8: /home/travis/R/Library/Rcpp/include/Rcpp/internal/r_vector.h"                     </span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; [10] "#File 9: /home/travis/build/jimhester/r-source/src/main/dotcode.c"                         </span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; [11] "#File 10: /home/travis/build/jimhester/r-source/src/unix/sys-unix.c"                       </span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; [12] "#File 11: /home/travis/build/jimhester/r-source/src/main/errors.c"</span></a></code></pre></div>
<p>Furthermore <code><a href="../reference/start_profiler.html">stop_profiler()</a></code> returns an in-memory representation of the profiled data, invisibly. See <a href="https://r-prof.github.io/profile/reference/validate_profile.html"><code>?profiler::validate_profile</code></a> for a description of the data format.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">out_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="st">"jointprof"</span>, <span class="dt">fileext =</span> <span class="st">".out"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw"><a href="../reference/start_profiler.html">start_profiler</a></span>(out_file)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; Temporary files: /tmp/RtmpIW8ynj/jointprof51e77dceb262.prof, /tmp/RtmpIW8ynj/jointprof51e730922be6.out</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">test</span>(<span class="dv">700</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">profile_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/start_profiler.html">stop_profiler</a></span>()</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">profile_data</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; Profile data: 579 samples</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">profile_data<span class="op">$</span>samples</a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; # A tibble: 579 x 4</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt;    value locations          .pprof_locations  .rprof_locations  </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt;    &lt;int&gt; &lt;list&gt;             &lt;list&gt;            &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt;  1     1 &lt;tibble [116 × 1]&gt; &lt;tibble [63 × 1]&gt; &lt;tibble [116 × 1]&gt;</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt;  2     1 &lt;tibble [76 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [76 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt;  3     1 &lt;tibble [42 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [41 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;  4     1 &lt;tibble [121 × 1]&gt; &lt;tibble [63 × 1]&gt; &lt;tibble [121 × 1]&gt;</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt;  5     1 &lt;tibble [204 × 1]&gt; &lt;tibble [63 × 1]&gt; &lt;tibble [204 × 1]&gt;</span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt;  6     1 &lt;tibble [43 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [42 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">#&gt;  7     1 &lt;tibble [85 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [85 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt;  8     1 &lt;tibble [42 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [41 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22"><span class="co">#&gt;  9     1 &lt;tibble [42 × 1]&gt;  &lt;tibble [63 × 1]&gt; &lt;tibble [41 × 1]&gt; </span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">#&gt; 10     1 &lt;tibble [190 × 1]&gt; &lt;tibble [63 × 1]&gt; &lt;tibble [190 × 1]&gt;</span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24"><span class="co">#&gt; # … with 569 more rows</span></a>
<a class="sourceLine" id="cb15-25" data-line-number="25">profile_data<span class="op">$</span>locations</a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="co">#&gt; # A tibble: 451 x 3</span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="co">#&gt;    location_id function_id  line</span></a>
<a class="sourceLine" id="cb15-28" data-line-number="28"><span class="co">#&gt;          &lt;int&gt;       &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb15-29" data-line-number="29"><span class="co">#&gt;  1           1           1     0</span></a>
<a class="sourceLine" id="cb15-30" data-line-number="30"><span class="co">#&gt;  2           2           2     4</span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31"><span class="co">#&gt;  3           3           3     0</span></a>
<a class="sourceLine" id="cb15-32" data-line-number="32"><span class="co">#&gt;  4           4           4     0</span></a>
<a class="sourceLine" id="cb15-33" data-line-number="33"><span class="co">#&gt;  5           5           5     4</span></a>
<a class="sourceLine" id="cb15-34" data-line-number="34"><span class="co">#&gt;  6           6           6     0</span></a>
<a class="sourceLine" id="cb15-35" data-line-number="35"><span class="co">#&gt;  7           7           7     0</span></a>
<a class="sourceLine" id="cb15-36" data-line-number="36"><span class="co">#&gt;  8           8           8     0</span></a>
<a class="sourceLine" id="cb15-37" data-line-number="37"><span class="co">#&gt;  9           9           9     0</span></a>
<a class="sourceLine" id="cb15-38" data-line-number="38"><span class="co">#&gt; 10          10          10     0</span></a>
<a class="sourceLine" id="cb15-39" data-line-number="39"><span class="co">#&gt; # … with 441 more rows</span></a>
<a class="sourceLine" id="cb15-40" data-line-number="40">profile_data<span class="op">$</span>functions</a>
<a class="sourceLine" id="cb15-41" data-line-number="41"><span class="co">#&gt; # A tibble: 172 x 5</span></a>
<a class="sourceLine" id="cb15-42" data-line-number="42"><span class="co">#&gt;    function_id name        system_name filename start_line</span></a>
<a class="sourceLine" id="cb15-43" data-line-number="43"><span class="co">#&gt;          &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;         &lt;int&gt;</span></a>
<a class="sourceLine" id="cb15-44" data-line-number="44"><span class="co">#&gt;  1           1 -           -           ""                0</span></a>
<a class="sourceLine" id="cb15-45" data-line-number="45"><span class="co">#&gt;  2           2 -           -           &lt;text&gt;            4</span></a>
<a class="sourceLine" id="cb15-46" data-line-number="46"><span class="co">#&gt;  3           3 ___elt      ...elt      ""                0</span></a>
<a class="sourceLine" id="cb15-47" data-line-number="47"><span class="co">#&gt;  4           4 _Call       .Call       ""                0</span></a>
<a class="sourceLine" id="cb15-48" data-line-number="48"><span class="co">#&gt;  5           5 +           +           &lt;text&gt;            4</span></a>
<a class="sourceLine" id="cb15-49" data-line-number="49"><span class="co">#&gt;  6           6 &lt;=          &lt;=          ""                0</span></a>
<a class="sourceLine" id="cb15-50" data-line-number="50"><span class="co">#&gt;  7           7 &lt;Anonymous&gt; &lt;Anonymous&gt; ""                0</span></a>
<a class="sourceLine" id="cb15-51" data-line-number="51"><span class="co">#&gt;  8           8 gc          &lt;GC&gt;        ""                0</span></a>
<a class="sourceLine" id="cb15-52" data-line-number="52"><span class="co">#&gt;  9           9 block_exec  block_exec  ""                0</span></a>
<a class="sourceLine" id="cb15-53" data-line-number="53"><span class="co">#&gt; 10          10 c           c           ""                0</span></a>
<a class="sourceLine" id="cb15-54" data-line-number="54"><span class="co">#&gt; # … with 162 more rows</span></a></code></pre></div>
<p>The profile data can be edited, and written to a file via <a href="https://r-prof.github.io/profile/reference/write_rprof.html"><code>write_rprof()</code></a> or (in <a href="https://github.com/google/pprof"><code>pprof</code></a>-compatible format) via <a href="https://r-prof.github.io/profile/reference/write_pprof.html"><code><a href="https://www.rdocumentation.org/packages/profile/topics/read_rprof">profile::write_pprof()</a></code></a>. The example below removes the first 15 entries from all samples, and writes the resulting profile data in <code>pprof</code> format:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">profile_data<span class="op">$</span>samples<span class="op">$</span>locations &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  profile_data<span class="op">$</span>samples<span class="op">$</span>locations,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  head,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="dv">-15</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">pprof_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="st">"jointprof"</span>, <span class="dt">fileext =</span> <span class="st">".pb.gz"</span>)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">profile<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/profile/topics/read_rprof">write_pprof</a></span>(profile_data, pprof_file)</a></code></pre></div>
<p>We then use <code>pprof</code> to visualize the call <em>graph</em>. The only exported function in the <em>pprof</em> package, <a href="https://r-prof.github.io/r-pprof/reference/get_pprof_pkg_path.html"><code>get_pprof_pkg_path()</code></a>, tells us the path to the <code>pprof</code> executable.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files2">dir.create</a></span>(<span class="kw">knit_dir</span>(<span class="st">"jointprof_fig"</span>), <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; Warning in dir.create(knit_dir("jointprof_fig"), recursive = TRUE): '/home/travis/build/r-prof/</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; jointprof/vignettes/jointprof_fig' already exists</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">svg_file &lt;-<span class="st"> </span><span class="kw">knit_dir</span>(<span class="st">"jointprof_fig/minimal.svg"</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system2">system2</a></span>(</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="kw"><a href="../reference/find_pprof.html">find_pprof</a></span>(),</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    <span class="st">"-svg"</span>,</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">    <span class="st">"-nodefraction 0.01"</span>,</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">    <span class="st">"-output"</span>,</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/shQuote">shQuote</a></span>(svg_file),</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/shQuote">shQuote</a></span>(pprof_file)</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">  )</a>
<a class="sourceLine" id="cb17-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb17-16" data-line-number="16"></a>
<a class="sourceLine" id="cb17-17" data-line-number="17">png_file &lt;-<span class="st"> </span><span class="kw">knit_dir</span>(<span class="st">"jointprof_fig/minimal.png"</span>)</a>
<a class="sourceLine" id="cb17-18" data-line-number="18">rsvg<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsvg/topics/rsvg">rsvg_png</a></span>(svg_file, png_file, <span class="dt">width =</span> <span class="dv">680</span>)</a></code></pre></div>
<p><a href="jointprof_fig/minimal.svg"><img src="jointprof_fig/minimal.png" alt="Call graph (click to show image)"></a></p>
<p>The call graph shows a unified view of run time costs for both R and native code. (Click on the image to see the SVG version.)</p>
<p>For interactive exploration of a call graph, try the built-in web browser view:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system2">system2</a></span>(</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  <span class="kw"><a href="../reference/find_pprof.html">find_pprof</a></span>(),</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    <span class="st">"-http"</span>,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="st">"localhost:8080"</span>,</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/shQuote">shQuote</a></span>(pprof_file)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">)</a></code></pre></div>
</div>
<div id="other-packages-for-analyzing-profiler-data" class="section level2">
<h2 class="hasAnchor">
<a href="#other-packages-for-analyzing-profiler-data" class="anchor"></a>Other packages for analyzing profiler data</h2>
<p>I’m aware of the following R packages that process profiler data, ordered by date of first CRAN release:</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/proftools/index.html"><em>proftools</em></a>: Mature, the paper’s includes facilities for summarizing results at the function, call, and source line level; for filtering to narrow the focus to functions of primary interest; and for visualizing profiling data. Also offers an export to <a href="http://valgrind.org/docs/manual/cl-manual.html">callgrind</a> format.</p></li>
<li><p><a href="https://rstudio.github.io/profvis/"><em>profvis</em></a>: Interactive exploration of the flame graph and call tree in a web browser.</p></li>
<li><p><a href="https://github.com/artemklevtsov/prof.tree#proftree"><em>prof.tree</em></a>: Shows a call tree on the console.</p></li>
</ul>
<p>I’d also like to mention two other tools outside the R ecosystem:</p>
<ul>
<li><p><a href="https://github.com/google/pprof"><code>pprof</code></a>: A new tool written in Go, supports varios output formats (including callgrind) and also interactive exploration of the flame graph and call graph in a web browser.</p></li>
<li><p><a href="https://kcachegrind.github.io/html/Home.html">KCacheGrind</a>: KDE-based interactive exploration, expects callgrind input.</p></li>
</ul>
</div>
<div id="caveats" class="section level2">
<h2 class="hasAnchor">
<a href="#caveats" class="anchor"></a>Caveats</h2>
<p>A few major points have been left unresolved until a forthcoming release:</p>
<ul>
<li>Nested calls back into R code are not fully supported yet. In situations where native code evaluates R expressions which then invoke native code again, the recorded stack trace will look wrong.</li>
</ul>
<p>If your R code calls into native code, or if you want to try <code>pprof</code> with R profiling results, give the <em>jointprof</em> package a try! If you discover problems or have comments, <a href="https://github.com/r-prof/jointprof/issues">file an issue</a>. I’d be especially grateful for help with other Linux distributions or OS X.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisite-code-to-profile">Prerequisite: Code to profile</a></li>
      <li><a href="#a-minimal-example">A minimal example</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#usage">Usage</a></li>
      <li><a href="#other-packages-for-analyzing-profiler-data">Other packages for analyzing profiler data</a></li>
      <li><a href="#caveats">Caveats</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, <a href="https://www.r-consortium.org">R Consortium</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
